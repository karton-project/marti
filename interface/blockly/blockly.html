<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Blockly Demo: Generating JavaScript</title>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0'/>
    <link href='../style/blockly.css' rel='stylesheet' type='text/css'/>
    <link href="https://fonts.googleapis.com/css?family=Josefin+Sans" rel="stylesheet">
    <link href="../../libraries/leaflet/leaflet.css" rel="stylesheet">
    <link href="../../libraries/c3/c3.css" rel="stylesheet">
    <link href="../../libraries/geocoder/Control.OSMGeocoder.css" rel="stylesheet">
    <link href="../style/selectize.css" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"
          integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">

    <script src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
    <script src="http://code.jquery.com/ui/1.8.21/jquery-ui.min.js"></script>
    <script src="../../libraries/jquery-ui-touch-punch.min.js"></script>
    <script src="../../libraries/blockly/blockly_compressed.js"></script>
    <script src="../../libraries/blockly/blocks_compressed.js"></script>
    <script src="../../libraries/blockly/javascript_compressed.js"></script>
    <script src="../../libraries/blockly/msg/js/en.js"></script>
    <script src="../../libraries/blockly/msg/js/tr.js"></script>
    <script src="js/music_maker.js"></script>
    <script src="js/generator.js"></script>
    <script src="../../libraries/underscore.min.js"></script>
    <script src="../js/constants.js"></script>
    <script src="../js/utils.js"></script>
    <script src="../js/en.js"></script>
    <script defer src="../../libraries/tracking/tracking-min.js"></script>
    <script defer src="../test/basics.js"></script>
    <script defer src="../../libraries/p5.js/p5.min.js"></script>
    <script defer src="../../libraries/p5.js/p5.dom.min.js"></script>
    <script defer src="../js/camera/operations.js"></script>
    <script defer src="../js/camera/blocks.js"></script>
    <script defer src="../js/file/operations.js"></script>
    <script defer src="../js/file/blocks.js"></script>
    <script defer src="../js/picture/operations.js"></script>
    <script defer src="../js/picture/blocks.js"></script>
    <script defer src="../js/map/operations.js"></script>
    <script defer src="../js/map/blocks.js"></script>
    <script defer src="../js/general/operations.js"></script>
    <script defer src="../js/general/blocks.js"></script>
    <script defer src="../js/visualization/operations.js"></script>
    <script defer src="../js/visualization/blocks.js"></script>
    <script defer src="../../libraries/caman.min.js"></script>
    <script defer src="../../libraries/d3/d3.min.js"></script>
    <script defer src="../../libraries/c3/c3.js"></script>
    <script defer src="../../libraries/d3/d3-scale.min.js"></script>
    <script defer src="../../libraries/d3/d3-simple-slider.min.js"></script>
    <script defer src="../../libraries/underscore.min.js"></script>
    <script defer src="../../libraries/d3/d3-peaks.js"></script>
    <script defer src="https://d3js.org/d3-dsv.v1.min.js"></script>
    <script defer src="https://d3js.org/d3-fetch.v1.min.js"></script>
    <script defer src="../../libraries/Pizzicato.min.js"></script>
    <script defer src="../../libraries/wavesurfer.min.js"></script>
    <script defer src="../../libraries/leaflet/leaflet.js"></script>
    <script defer src="../../libraries/leaflet/tile.stamen.js"></script>
    <script defer src="https://unpkg.com/@tensorflow/tfjs"></script>
    <script defer src="https://unpkg.com/@tensorflow-models/mobilenet"></script>
    <script defer src="https://unpkg.com/@tensorflow-models/knn-classifier"></script>
    <script defer src="../../libraries/geocoder/Control.OSMGeocoder.js"></script>
    <script defer src="../../libraries/geocoder/geocoder.js"></script>
    <script defer src="../../libraries/speech/annyang.min.js"></script>
    <script defer src="../../libraries/speech/speechkitt.min.js"></script>
    <script defer src="js/p5_maker.js"></script>
    <script defer src="js/output.js"></script>
    <style>
        body {
            background-color: #ffaaaa;
            color: #000000;
        }
    </style>
</head>
<body>

<input type="file" id="imageFile" accept=".png, .jpg, .jpeg" style="display:none"></input>
<input type="file" id="csvFile" accept=".csv" style="display:none"></input>
<input type="file" id="geoJSONFile" accept=".geojson" style="display:none"></input>

<h1>Veri Programlama</h1>

<p>
    <button onclick="showCode()">JS Kodu Göster</button>
    <button onclick="runCode()">Çalıştır</button>
</p>

<div class="grid-container">
    <p>Code</p>
    <p>Output</p>
</div>
<div class="grid-container">
    <div id="blocklyDiv" class="code_container"></div>
    <div id="visualContainer" class="container visualization_container">
        <ul id="tab_list" class="tabs"></ul>
    </div>
</div>

<xml id="toolbox" style="display: none">
    <category name="%{BKY_CATLOGIC}" colour="%{BKY_LOGIC_HUE}">
        <block type="controls_if"></block>
        <block type="logic_compare"></block>
        <block type="logic_operation"></block>
        <block type="logic_negate"></block>
        <block type="logic_boolean"></block>
        <block type="logic_null"></block>
        <block type="logic_ternary"></block>
    </category>
    <category name="%{BKY_CATLOOPS}" colour="%{BKY_LOOPS_HUE}">
        <block type="controls_repeat_ext">
            <value name="TIMES">
                <shadow type="math_number">
                    <field name="NUM">10</field>
                </shadow>
            </value>
        </block>
        <block type="controls_whileUntil"></block>
        <block type="controls_for">
            <value name="FROM">
                <shadow type="math_number">
                    <field name="NUM">1</field>
                </shadow>
            </value>
            <value name="TO">
                <shadow type="math_number">
                    <field name="NUM">10</field>
                </shadow>
            </value>
            <value name="BY">
                <shadow type="math_number">
                    <field name="NUM">1</field>
                </shadow>
            </value>
        </block>
        <block type="controls_forEach"></block>
        <block type="controls_flow_statements"></block>
    </category>
    <category name="%{BKY_CATMATH}" colour="%{BKY_MATH_HUE}">
        <block type="math_number">
            <field name="NUM">123</field>
        </block>
        <block type="slice"></block>
        <block type="math_arithmetic">
            <value name="A">
                <shadow type="math_number">
                    <field name="NUM">1</field>
                </shadow>
            </value>
            <value name="B">
                <shadow type="math_number">
                    <field name="NUM">1</field>
                </shadow>
            </value>
        </block>
        <block type="math_single">
            <value name="NUM">
                <shadow type="math_number">
                    <field name="NUM">9</field>
                </shadow>
            </value>
        </block>
        <block type="math_trig">
            <value name="NUM">
                <shadow type="math_number">
                    <field name="NUM">45</field>
                </shadow>
            </value>
        </block>
        <block type="math_constant"></block>
        <block type="math_number_property">
            <value name="NUMBER_TO_CHECK">
                <shadow type="math_number">
                    <field name="NUM">0</field>
                </shadow>
            </value>
        </block>
        <block type="math_round">
            <value name="NUM">
                <shadow type="math_number">
                    <field name="NUM">3.1</field>
                </shadow>
            </value>
        </block>
        <block type="math_on_list"></block>
        <block type="math_modulo">
            <value name="DIVIDEND">
                <shadow type="math_number">
                    <field name="NUM">64</field>
                </shadow>
            </value>
            <value name="DIVISOR">
                <shadow type="math_number">
                    <field name="NUM">10</field>
                </shadow>
            </value>
        </block>
        <block type="math_constrain">
            <value name="VALUE">
                <shadow type="math_number">
                    <field name="NUM">50</field>
                </shadow>
            </value>
            <value name="LOW">
                <shadow type="math_number">
                    <field name="NUM">1</field>
                </shadow>
            </value>
            <value name="HIGH">
                <shadow type="math_number">
                    <field name="NUM">100</field>
                </shadow>
            </value>
        </block>
        <block type="math_random_int">
            <value name="FROM">
                <shadow type="math_number">
                    <field name="NUM">1</field>
                </shadow>
            </value>
            <value name="TO">
                <shadow type="math_number">
                    <field name="NUM">100</field>
                </shadow>
            </value>
        </block>
        <block type="filter"></block>
        <block type="maximum"></block>
        <block type="minimum"></block>
        <block type="average"></block>
    </category>
    <category name="p5.js" colour="#ED225D">
        <category name="Structure" colour="#F47A9E">
            <block type="createcanvas"></block>
            <block type="setup"></block>
            <block type="draw"></block>
        </category>
        <category name="Shape" colour="#F47A9E">
            <block type="ellipse"></block>
            <block type="rect"></block>
        </category>
        <category name="Events" colour="#F47A9E">
            <block type="mousex"></block>
            <block type="mousey"></block>
        </category>
        <category name="Color" colour="#F47A9E">
            <block type="fill"></block>
            <block type="background"></block>
        </category>
    </category>
    <category name="%{BKY_CATTEXT}" colour="%{BKY_TEXTS_HUE}">
        <block type="text"></block>
        <block type="text_join"></block>
        <block type="text_append">
            <value name="TEXT">
                <shadow type="text"></shadow>
            </value>
        </block>
        <block type="text_length">
            <value name="VALUE">
                <shadow type="text">
                    <field name="TEXT">abc</field>
                </shadow>
            </value>
        </block>
        <block type="text_isEmpty">
            <value name="VALUE">
                <shadow type="text">
                    <field name="TEXT"></field>
                </shadow>
            </value>
        </block>
        <block type="text_indexOf">
            <value name="VALUE">
                <block type="variables_get">
                    <field name="VAR">text</field>
                </block>
            </value>
            <value name="FIND">
                <shadow type="text">
                    <field name="TEXT">abc</field>
                </shadow>
            </value>
        </block>
        <block type="text_charAt">
            <value name="VALUE">
                <block type="variables_get">
                    <field name="VAR">text</field>
                </block>
            </value>
        </block>
        <block type="text_getSubstring">
            <value name="STRING">
                <block type="variables_get">
                    <field name="VAR">text</field>
                </block>
            </value>
        </block>
        <block type="text_changeCase">
            <value name="TEXT">
                <shadow type="text">
                    <field name="TEXT">abc</field>
                </shadow>
            </value>
        </block>
        <block type="text_trim">
            <value name="TEXT">
                <shadow type="text">
                    <field name="TEXT">abc</field>
                </shadow>
            </value>
        </block>
        <block type="text_print">
            <value name="TEXT">
                <shadow type="text">
                    <field name="TEXT">abc</field>
                </shadow>
            </value>
        </block>
        <block type="text_prompt_ext">
            <value name="TEXT">
                <shadow type="text">
                    <field name="TEXT">abc</field>
                </shadow>
            </value>
        </block>
    </category>
    <category name="%{BKY_CATLISTS}" colour="%{BKY_LISTS_HUE}">
        <block type="lists_create_with">
            <mutation items="0"></mutation>
        </block>
        <block type="lists_create_with"></block>
        <block type="lists_repeat">
            <value name="NUM">
                <shadow type="math_number">
                    <field name="NUM">5</field>
                </shadow>
            </value>
        </block>
        <block type="lists_length"></block>
        <block type="lists_isEmpty"></block>
        <block type="lists_indexOf">
            <value name="VALUE">
                <block type="variables_get">
                    <field name="VAR">list</field>
                </block>
            </value>
        </block>
        <block type="lists_getIndex">
            <value name="VALUE">
                <block type="variables_get">
                    <field name="VAR">list</field>
                </block>
            </value>
        </block>
        <block type="lists_setIndex">
            <value name="LIST">
                <block type="variables_get">
                    <field name="VAR">list</field>
                </block>
            </value>
        </block>
        <block type="lists_getSublist">
            <value name="LIST">
                <block type="variables_get">
                    <field name="VAR">list</field>
                </block>
            </value>
        </block>
        <block type="lists_split">
            <value name="DELIM">
                <shadow type="text">
                    <field name="TEXT">,</field>
                </shadow>
            </value>
        </block>
        <block type="lists_sort"></block>
    </category>
    <category name="%{BKY_CATCOLOUR}" colour="%{BKY_COLOUR_HUE}">
        <block type="colour_picker"></block>
        <block type="colour_random"></block>
        <block type="colour_rgb">
            <value name="RED">
                <shadow type="math_number">
                    <field name="NUM">100</field>
                </shadow>
            </value>
            <value name="GREEN">
                <shadow type="math_number">
                    <field name="NUM">50</field>
                </shadow>
            </value>
            <value name="BLUE">
                <shadow type="math_number">
                    <field name="NUM">0</field>
                </shadow>
            </value>
        </block>
        <block type="colour_blend">
            <value name="COLOUR1">
                <shadow type="colour_picker">
                    <field name="COLOUR">#ff0000</field>
                </shadow>
            </value>
            <value name="COLOUR2">
                <shadow type="colour_picker">
                    <field name="COLOUR">#3333ff</field>
                </shadow>
            </value>
            <value name="RATIO">
                <shadow type="math_number">
                    <field name="NUM">0.5</field>
                </shadow>
            </value>
        </block>
    </category>
    <sep></sep>
    <category name="%{BKY_CATVARIABLES}" colour="%{BKY_VARIABLES_HUE}" custom="VARIABLE"></category>
    <category name="%{BKY_CATFUNCTIONS}" colour="%{BKY_PROCEDURES_HUE}" custom="PROCEDURE"></category>
    <sep></sep>
    <category name="%{BKY_CATFILE}" colour="173">
        <block type="open_file_weblink"></block>
        <block type="open_file_from_computer"></block>
        <block type="create_table"></block>
        <block type="create_table_row"></block>
        <block type="print_table"></block>
        <block type="list_key_elements"></block>
        <block type="get_column"></block>
    </category>
    <category name="%{BKY_CATMAP}" colour="95">
        <block type="open_map"></block>
        <block type="add_marker"></block>
    </category>
    <category name="%{BKY_CATCAMERA}" colour="334">
        <block type="start_camera"></block>
    </category>
    <category name="%{BKY_CATSOUND}" colour="204">
        <block type="play_sound"></block>
    </category>
    <category name="%{BKY_CATIO}" colour="204">
        <block type="mouse_x"></block>
    </category>
</xml>

<xml id="startBlocks" style="display: none">
    <block type="setup">
        <statement name="do">
            <block type="createcanvas">
                <value name="width">
                    <block type="math_number">
                        <field name="NUM">500</field>
                    </block>
                </value>
                <value name="height">
                    <block type="math_number">
                        <field name="NUM">500</field>
                    </block>
                </value>
                <value name="canvas">
                    <block type="text">
                        <field name="TEXT">visualization_pfive</field>
                    </block>
                </value>
                <next>
                    <block type="fill">
                        <value name="NAME">
                            <block type="math_number">
                                <field name="NUM">255</field>
                            </block>
                        </value>
                    </block>
                </next>
            </block>
        </statement>
        <next>
            <block type="draw">
                <statement name="do">
                    <block type="background">
                        <value name="NAME">
                            <block type="math_number">
                                <field name="NUM">200</field>
                            </block>
                        </value>
                        <next>
                            <block type="ellipse">
                                <value name="x">
                                    <block type="math_number">
                                        <field name="NUM">200</field>
                                    </block>
                                </value>
                                <value name="y">
                                    <block type="math_number">
                                        <field name="NUM">200</field>
                                    </block>
                                </value>
                                <value name="width">
                                    <block type="math_number">
                                        <field name="NUM">50</field>
                                    </block>
                                </value>
                                <value name="height">
                                    <block type="math_number">
                                        <field name="NUM">50</field>
                                    </block>
                                </value>
                            </block>
                        </next>
                    </block>
                </statement>
            </block>
        </next>
    </block>
</xml>

<script>
    window.onload = function () {
        setTimeout(function () {
            prepareTabList();
            changeViewForP5();
        }, 0);
    };

    var demoWorkspace = Blockly.inject('blocklyDiv', {
        media: '../media/blockly/',
        toolbox: document.getElementById('toolbox')
    });
    Blockly.Xml.domToWorkspace(document.getElementById('startBlocks'), demoWorkspace);

    function showCode() {
        Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
        var code = Blockly.JavaScript.workspaceToCode(demoWorkspace);
        console.log(code);
    }

    function runCode() {
        window.LoopTrap = 1000;
        Blockly.JavaScript.INFINITE_LOOP_TRAP = 'if (--window.LoopTrap == 0) throw "Infinite loop.";\n';
        var code = Blockly.JavaScript.workspaceToCode(demoWorkspace);
        code += 'MusicMaker.play();';
        Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
        try {
            //eval(code);
            document.getElementById("visualization_pfive").innerHTML = "";
            let blockp5 = new Blockp5(code);
            blockp5.runCode();
        } catch (e) {
            alert(e);
        }
    }
</script>

</body>
</html>
